<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ›æ„æ„æ€å·¥å…·</title>
    <style>
        /* --- åŸºç¡€ä¸å˜é‡å®šä¹‰ (v2.2 - çµæ„ŸçŸ©é˜µ) --- */
        :root {
            --primary-color: #0D9488; --primary-color-dark: #0F766E; --background-color: #F9FAFB;
            --surface-color: #FFFFFF; --text-color-primary: #1F2937; --text-color-secondary: #6B7280;
            --text-color-light: #9CA3AF; --border-color: #E5E7EB; --warning-color: #E11D48;
            --success-color: #16A34A; --font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
            --border-radius: 6px;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: var(--font-family); background: var(--background-color);
            line-height: 1.5; color: var(--text-color-primary);
            -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
        }
        .container { max-width: 960px; margin: 0 auto; display: flex; min-height: 100vh; }
        .main { flex: 1; padding: 40px; background: var(--surface-color); }
        .header { text-align: center; margin-bottom: 40px; padding-bottom: 20px; border-bottom: 1px solid var(--border-color); }
        .header h1 { font-size: 28px; margin-bottom: 8px; font-weight: 700; }
        .header p { color: var(--text-color-secondary); font-size: 15px; }
        .author-link { font-size: 14px; color: var(--text-color-secondary); margin-top: 12px; }
        .author-link a { color: var(--text-color-primary); font-weight: 500; text-decoration: none; transition: color 0.2s ease; }
        .author-link a:hover { color: var(--primary-color); text-decoration: underline; }
        .progress { height: 4px; background: #F3F4F6; margin: 24px auto 0; border-radius: 2px; max-width: 320px; }
        .progress-fill { height: 100%; background: var(--primary-color); width: 0%; transition: width 0.5s cubic-bezier(0.25, 1, 0.5, 1); border-radius: 2px; }
        .step { display: none; }
        .step.active { display: block; }
        .step.animate-in { animation: fadeIn 0.5s ease-out forwards; }
        .step.animate-out { animation: fadeOut 0.3s ease-in forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeOut { from { opacity: 1; transform: translateY(0); } to { opacity: 0; transform: translateY(-10px); } }
        .step-header { display: flex; align-items: center; margin-bottom: 30px; }
        .step-number { width: 36px; height: 36px; background: var(--primary-color); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 16px; margin-right: 16px; flex-shrink: 0; }
        .step-info h3 { font-size: 20px; color: var(--text-color-primary); margin-bottom: 2px; }
        .step-info p { color: var(--text-color-secondary); font-size: 14px; }
        .timer { margin-left: auto; font-size: 16px; color: var(--primary-color); font-weight: 600; background: #F0FDFA; padding: 5px 12px; border-radius: 16px; transition: all 0.3s ease; }
        .timer.warning { color: var(--warning-color); background: #FFF1F2; }
        .form-group { margin-bottom: 25px; }
        .form-group label { display: block; font-size: 14px; font-weight: 600; color: var(--text-color-primary); margin-bottom: 8px; }
        .form-group input, .form-group textarea { width: 100%; padding: 10px 12px; border: 1px solid var(--border-color); border-radius: var(--border-radius); font-size: 14px; font-family: inherit; resize: vertical; background: #F9FAFB; transition: all 0.25s ease-out; }
        .form-group input:focus, .form-group textarea:focus { outline: none; border-color: var(--primary-color); background: var(--surface-color); box-shadow: 0 0 0 3px rgba(13, 148, 136, 0.1); }
        .form-group textarea { min-height: 90px; }
        
        /* --- V2ï¼šçµæ„ŸçŸ©é˜µæ ·å¼ --- */
        .inspiration-group { margin-top: 12px; }
        .inspiration-group p { font-size: 13px; font-weight: 500; color: var(--text-color-secondary); margin-bottom: 8px; }
        .inspiration-triggers button {
            background: none; border: 1px solid var(--border-color); color: var(--text-color-secondary);
            font-size: 13px; font-weight: 500; padding: 4px 10px; border-radius: 4px; cursor: pointer;
            transition: all 0.2s ease; margin-right: 6px;
        }
        .inspiration-triggers button:hover { background: #F3F4F6; color: var(--text-color-primary); }
        .inspiration-suggestions {
            margin-top: 12px; padding: 12px; background: #F9FAFB;
            border-radius: 4px; display: none; /* é»˜è®¤éšè— */
        }
        .suggestion-item-random {
            font-size: 13px; color: var(--text-color-secondary); cursor: pointer;
            margin-bottom: 8px; transition: color 0.2s ease;
        }
        .suggestion-item-random:hover { color: var(--primary-color); }
        .suggestion-item-random:last-child { margin-bottom: 0; }
        .inspiration-refresh {
            margin-top: 12px; padding-top: 8px; border-top: 1px dashed var(--border-color);
            text-align: right;
        }
        .btn-refresh {
            background: none; border: none; color: var(--primary-color); font-size: 13px;
            cursor: pointer; font-weight: 500;
        }

        .buttons { display: flex; justify-content: space-between; margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--border-color); }
        .btn { padding: 10px 24px; border: none; border-radius: var(--border-radius); font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s ease-out; }
        .btn-primary { background: var(--primary-color); color: white; box-shadow: var(--shadow-sm); }
        .btn-primary:hover { background: var(--primary-color-dark); transform: translateY(-1px); }
        .btn-secondary { background: var(--surface-color); color: var(--text-color-secondary); border: 1px solid var(--border-color); }
        .btn-secondary:hover { background: #F9FAFB; border-color: #D1D5DB; color: var(--text-color-primary); }
        .result { background: #F9FAFB; border-radius: var(--border-radius); padding: 30px; margin-top: 20px; }
        .result h3 { color: var(--text-color-primary); margin-bottom: 20px; font-size: 18px; }
        .result-item { background: var(--surface-color); border-radius: var(--border-radius); padding: 16px; margin-bottom: 12px; border-left: 3px solid var(--primary-color); box-shadow: var(--shadow-sm); }
        .result-label { font-weight: 600; color: var(--text-color-primary); margin-bottom: 6px; font-size: 14px; }
        .result-content { color: var(--text-color-secondary); font-size: 14px; white-space: pre-wrap; }
        .floating-summary { position: fixed; top: 20px; right: 20px; width: 260px; max-height: 400px; background: var(--surface-color); border: 1px solid var(--border-color); border-radius: var(--border-radius); box-shadow: var(--shadow-md); z-index: 1000; transform: translateX(120%); transition: transform 0.4s cubic-bezier(0.25, 1, 0.5, 1); overflow: hidden; display: flex; flex-direction: column; }
        .floating-summary.visible { transform: translateX(0); }
        .floating-header { padding: 8px 12px; background: #F9FAFB; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
        .floating-header h3 { font-size: 13px; color: var(--text-color-primary); margin: 0; font-weight: 600; }
        .close-btn { background: none; border: none; font-size: 18px; color: var(--text-color-light); cursor: pointer; padding: 2px; width: 22px; height: 22px; display: flex; align-items: center; justify-content: center; border-radius: 4px; transition: all 0.2s ease; }
        .close-btn:hover { background: #E5E7EB; color: var(--text-color-primary); }
        .floating-content { padding: 8px; overflow-y: auto; }
        .step-summary { margin-bottom: 6px; padding: 8px; background: #F9FAFB; border-radius: 4px; border-left: 2px solid var(--primary-color); }
        .step-summary:last-child { margin-bottom: 0; }
        .step-title { font-weight: 600; color: var(--text-color-primary); margin-bottom: 3px; font-size: 12px; }
        .step-content { color: var(--text-color-secondary); font-size: 12px; line-height: 1.4; }
        .toggle-summary { position: fixed; top: 20px; right: 20px; background: var(--primary-color); color: white; border: none; width: 40px; height: 40px; border-radius: 20px; font-size: 18px; cursor: pointer; box-shadow: var(--shadow-md); z-index: 999; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease; transform-origin: center; }
        .toggle-summary:hover { background: var(--primary-color-dark); transform: scale(1.1); }
        .toggle-summary.hidden { transform: scale(0); opacity: 0; }
        @media (max-width: 768px) {
            .main { padding: 25px 20px; } .header h1 { font-size: 24px; }
            .step-header { flex-direction: column; align-items: flex-start; }
            .timer { margin-left: 0; margin-top: 15px; }
            .floating-summary { width: 240px; right: 15px; top: 15px; }
            .toggle-summary { right: 15px; top: 15px; }
            .buttons { flex-direction: column-reverse; gap: 10px; } .btn { width: 100%; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="floating-summary" id="floatingSummary">
            <div class="floating-header"><h3>æ„æ€è®°å½•</h3><button class="close-btn" onclick="toggleSummary()">Ã—</button></div>
            <div class="floating-content" id="floatingContent"></div>
        </div>
        <button class="toggle-summary hidden" id="toggleBtn" onclick="toggleSummary()">ğŸ“</button>
        <div class="main">
            <div class="header">
                <h1>åˆ›æ„æ„æ€å·¥å…·</h1>
                <p>ä»å¸¸è§„åˆ°ç‹¬ç‰¹çš„20åˆ†é’Ÿæ„æ€æ³•</p>
                <p class="author-link">ç”± <a href="https://github.com/wulideng" target="_blank" rel="noopener noreferrer">wulideng</a> åˆ›ä½œ</p>
                <div class="progress"><div class="progress-fill" id="progressFill"></div></div>
            </div>

            <!-- å¼€å§‹é¡µ -->
            <div class="step active" id="step0">
                <div class="step-header"><div class="step-number">0</div><div class="step-info"><h3>ç¡®å®šä¸»é¢˜</h3><p>ä½ æƒ³åˆ›ä½œä»€ä¹ˆï¼Ÿ</p></div></div>
                <div class="form-group"><label for="theme">åˆ›ä½œä¸»é¢˜</label><input type="text" id="theme" placeholder="ä¾‹å¦‚ï¼šèŠ±ç«å¤§ä¼šã€å’–å•¡åº—ã€é›¨å¤œ..."></div>
                <div class="buttons"><div></div><button class="btn btn-primary" onclick="nextStep()">å¼€å§‹æ„æ€</button></div>
            </div>

            <!-- ç¬¬1æ­¥ï¼šé€‰å®šé”šç‚¹ -->
            <div class="step" id="step1">
                <div class="step-header"><div class="step-number">1</div><div class="step-info"><h3>é€‰å®šæ ¸å¿ƒé”šç‚¹</h3><p>é€‰æ‹©ä¸€ä¸ªå…·ä½“çš„ç‰©å“ã€åœ°ç‚¹æˆ–äººç‰©ä½œä¸ºæ•…äº‹æ ¸å¿ƒ</p></div><div class="timer" id="timer1">3:00</div></div>
                <div class="form-group"><label for="anchor">æ ¸å¿ƒé”šç‚¹</label><input type="text" id="anchor" placeholder="ä¸€ä¸ªå…·ä½“çš„ç‰©å“ã€åœ°ç‚¹æˆ–äººç‰©"></div>
                <div class="form-group"><label for="anchorReason">ä¸ºä»€ä¹ˆé€‰æ‹©è¿™ä¸ªï¼Ÿ</label><textarea id="anchorReason" placeholder="è¿™ä¸ªé”šç‚¹æœ‰ä»€ä¹ˆç‰¹åˆ«ä¹‹å¤„ï¼Ÿ"></textarea>
                    <!-- æ–°å¢ï¼šçµæ„ŸçŸ©é˜µ -->
                    <div class="inspiration-group">
                        <p>ğŸ’¡ éœ€è¦çµæ„Ÿï¼Ÿ</p>
                        <div class="inspiration-triggers">
                            <button onclick="showRandomSuggestions('anchorReason', 'keywords')">[ å…³é”®è¯ ]</button>
                            <button onclick="showRandomSuggestions('anchorReason', 'imagery')">[ æ ¸å¿ƒæ„è±¡ ]</button>
                            <button onclick="showRandomSuggestions('anchorReason', 'whatIf')">[ å¦‚æœâ€¦ ]</button>
                        </div>
                        <div class="inspiration-suggestions" id="suggestions-for-anchorReason"></div>
                    </div>
                </div>
                <div class="buttons"><button class="btn btn-secondary" onclick="prevStep()">ä¸Šä¸€æ­¥</button><button class="btn btn-primary" onclick="nextStep()">ä¸‹ä¸€æ­¥ (5åˆ†é’Ÿ)</button></div>
            </div>

            <!-- ç¬¬2æ­¥ï¼šæ„å¤–å±æ€§ -->
            <div class="step" id="step2">
                 <div class="step-header"><div class="step-number">2</div><div class="step-info"><h3>èµ‹äºˆæ„å¤–å±æ€§</h3><p>ç»™ä½ çš„é”šç‚¹ä¸€ä¸ªä¸å¯»å¸¸çš„èƒŒæ™¯æˆ–ç‰¹å¾</p></div><div class="timer" id="timer2">5:00</div></div>
                <div class="form-group"><label for="unexpectedAttr">æ„å¤–å±æ€§</label><textarea id="unexpectedAttr" placeholder="è¿™ä¸ªé”šç‚¹æœ‰ä»€ä¹ˆæ„å¤–çš„æ¥æºã€ç”¨é€”æˆ–å«ä¹‰ï¼Ÿ"></textarea>
                    <div class="inspiration-group">
                        <p>ğŸ’¡ éœ€è¦çµæ„Ÿï¼Ÿ</p>
                        <div class="inspiration-triggers">
                            <button onclick="showRandomSuggestions('unexpectedAttr', 'keywords')">[ å…³é”®è¯ ]</button>
                            <button onclick="showRandomSuggestions('unexpectedAttr', 'imagery')">[ æ ¸å¿ƒæ„è±¡ ]</button>
                            <button onclick="showRandomSuggestions('unexpectedAttr', 'whatIf')">[ å¦‚æœâ€¦ ]</button>
                        </div>
                        <div class="inspiration-suggestions" id="suggestions-for-unexpectedAttr"></div>
                    </div>
                </div>
                <div class="form-group"><label for="relationship">äººç‰©å…³ç³»</label><textarea id="relationship" placeholder="è¿™ä¸ªå±æ€§å¦‚ä½•å½±å“äººç‰©ä¹‹é—´çš„å…³ç³»ï¼Ÿ"></textarea></div>
                <div class="buttons"><button class="btn btn-secondary" onclick="prevStep()">ä¸Šä¸€æ­¥</button><button class="btn btn-primary" onclick="nextStep()">ä¸‹ä¸€æ­¥ (5åˆ†é’Ÿ)</button></div>
            </div>
            
            <!-- ç¬¬3æ­¥ï¼šæ°›å›´è¥é€  -->
            <div class="step" id="step3">
                <div class="step-header"><div class="step-number">3</div><div class="step-info"><h3>æ°›å›´è¥é€ </h3><p>è®¾ç½®å‰æœŸæ°›å›´ï¼Œè®©è§‚ä¼—äº§ç”ŸæŸç§é¢„æœŸ</p></div><div class="timer" id="timer3">5:00</div></div>
                <div class="form-group"><label for="atmosphere">å‰æœŸæ°›å›´</label><textarea id="atmosphere" placeholder="ä½ æƒ³è¥é€ ä»€ä¹ˆæ ·çš„æ°›å›´ï¼Ÿè§‚ä¼—ä¼šæœ‰ä»€ä¹ˆæ„Ÿå—ï¼Ÿ"></textarea>
                     <div class="inspiration-group">
                        <p>ğŸ’¡ éœ€è¦çµæ„Ÿï¼Ÿ</p>
                        <div class="inspiration-triggers">
                            <button onclick="showRandomSuggestions('atmosphere', 'imagery')">[ æ ¸å¿ƒæ„è±¡ ]</button>
                            <button onclick="showRandomSuggestions('atmosphere', 'emotion')">[ æƒ…æ„ŸåŸºè°ƒ ]</button>
                        </div>
                        <div class="inspiration-suggestions" id="suggestions-for-atmosphere"></div>
                    </div>
                </div>
                <div class="form-group"><label for="expectation">è§‚ä¼—é¢„æœŸ</label><textarea id="expectation" placeholder="åœ¨è¿™ç§æ°›å›´ä¸‹ï¼Œè§‚ä¼—ä¼šæœŸå¾…å‘ç”Ÿä»€ä¹ˆï¼Ÿ"></textarea></div>
                <div class="buttons"><button class="btn btn-secondary" onclick="prevStep()">ä¸Šä¸€æ­¥</button><button class="btn btn-primary" onclick="nextStep()">ä¸‹ä¸€æ­¥ (7åˆ†é’Ÿ)</button></div>
            </div>

            <!-- ç¬¬4æ­¥ï¼šåè½¬è®¾è®¡ -->
            <div class="step" id="step4">
                 <div class="step-header"><div class="step-number">4</div><div class="step-info"><h3>åè½¬è®¾è®¡</h3><p>åœ¨å“ªä¸ªç‚¹æ‰“ç ´è§‚ä¼—çš„é¢„æœŸï¼Ÿ</p></div><div class="timer" id="timer4">7:00</div></div>
                <div class="form-group"><label for="twistPoint">åè½¬ç‚¹</label><textarea id="twistPoint" placeholder="ä»€ä¹ˆæ—¶å€™æ­ç¤ºçœŸç›¸ï¼Ÿé€šè¿‡ä»€ä¹ˆæ–¹å¼ï¼Ÿ"></textarea></div>
                <div class="form-group"><label for="twistContent">åè½¬å†…å®¹</label><textarea id="twistContent" placeholder="çœŸç›¸æ˜¯ä»€ä¹ˆï¼Ÿä¸é¢„æœŸæœ‰ä»€ä¹ˆå·®è·ï¼Ÿ"></textarea>
                     <div class="inspiration-group">
                        <p>ğŸ’¡ éœ€è¦çµæ„Ÿï¼Ÿ</p>
                        <div class="inspiration-triggers">
                            <button onclick="showRandomSuggestions('twistContent', 'keywords')">[ å…³é”®è¯ ]</button>
                            <button onclick="showRandomSuggestions('twistContent', 'whatIf')">[ å¦‚æœâ€¦ ]</button>
                             <button onclick="showRandomSuggestions('twistContent', 'conflict')">[ æ ¸å¿ƒå†²çª ]</button>
                        </div>
                        <div class="inspiration-suggestions" id="suggestions-for-twistContent"></div>
                    </div>
                </div>
                <div class="form-group"><label for="emotionArc">æƒ…ç»ªå¼§çº¿</label><textarea id="emotionArc" placeholder="ä»å¼€å§‹åˆ°ç»“æŸï¼Œä¸»è§’æˆ–è§‚ä¼—çš„æƒ…ç»ªå¦‚ä½•å˜åŒ–ï¼Ÿä¾‹å¦‚ï¼šå¹³é™ -> æœŸå¾… -> éœ‡æƒŠ -> æ‚²ä¼¤ -> é‡Šç„¶"></textarea></div>
                <div class="buttons"><button class="btn btn-secondary" onclick="prevStep()">ä¸Šä¸€æ­¥</button><button class="btn btn-primary" onclick="generateResult()">ç”Ÿæˆç»“æœ</button></div>
            </div>

            <!-- ç»“æœé¡µ -->
            <div class="step" id="step5">
                <div class="step-header"><div class="step-number" style="background: var(--success-color);">âœ“</div><div class="step-info"><h3>æ„æ€å®Œæˆ</h3><p>ä½ çš„ç‹¬ç‰¹åˆ›æ„å·²ç»æˆå‹</p></div></div>
                <div class="result" id="finalResult"></div>
                <div class="buttons"><button class="btn btn-secondary" onclick="exportResult()">å¯¼å‡ºæ„æ€ (TXT)</button><button class="btn btn-primary" onclick="restart()">é‡æ–°å¼€å§‹</button></div>
            </div>
        </div>
    </div>

    <script>
        let currentStep = 0, data = {}, timers = {};

        // --- V2ï¼šçµæ„ŸçŸ©é˜µåº“ ---
        const inspirationLibrary = {
            anchorReason: {
                keywords: ["æ‰¿è¯º", "ç§˜å¯†", "é—å¿˜", "é‡é€¢", "å‘Šåˆ«", "åŒ¿å", "å·§åˆ", "ä¼ æ‰¿", "è¯¯è§£", "æ•‘èµ"],
                imagery: ["è·³èš¤å¸‚åœºçš„è§’è½", "è½æ»¡ç°å°˜çš„é˜æ¥¼", "ä¸€ä¸ªåå¤å‡ºç°çš„æ¢¦", "ç«¥å¹´å¥½å‹çš„èµ ç¤¼", "åŒ¿åå¯„æ¥çš„åŒ…è£¹", "ä¸€å¼ æ³›é»„çš„æ—§åœ°å›¾"],
                whatIf: ["å¦‚æœè¿™æ˜¯é™Œç”Ÿäººé”™ç»™ä½ çš„ä¸œè¥¿ï¼Ÿ", "å¦‚æœå®ƒæ¥è‡ªæœªæ¥ï¼Ÿ", "å¦‚æœå®ƒèƒ½å¸¦ä½ å›åˆ°æŸä¸ªç‰¹å®šæ—¶åˆ»ï¼Ÿ", "å¦‚æœå®ƒæ˜¯æŸä¸ªç½ªæ¡ˆçš„å…³é”®è¯æ®ï¼Ÿ"]
            },
            unexpectedAttr: {
                keywords: ["ä¼ªè£…", "ä¿¡ç‰©", "é’¥åŒ™", "è¯…å’’", "åº‡æŠ¤", "èƒ½é‡æº", "åŒåˆƒå‰‘", "å°å°", "åœ°å›¾", "å€’è®¡æ—¶"],
                imagery: ["éšè—çš„å¤¹å±‚", "æœˆå…‰ä¸‹æµ®ç°çš„æ–‡å­—", "èƒ½è®°å½•æƒ…ç»ªçš„æè´¨", "å¹¶éæ¥è‡ªåœ°çƒçš„é‡‘å±", "ä¸¤ä¸ªä¸–ç•Œçš„äº¤æ±‡ç‚¹", "å¤è€ä»ªå¼çš„é“å…·"],
                whatIf: ["å¦‚æœå®ƒèƒ½ä¸ç‰¹å®šçš„äººäº§ç”Ÿå…±é¸£ï¼Ÿ", "å¦‚æœå®ƒæœ‰è‡ªå·±çš„æ„è¯†ï¼Ÿ", "å¦‚æœå®ƒçš„ä½œç”¨å’Œè¡¨é¢å®Œå…¨ç›¸åï¼Ÿ", "å¦‚æœå…¨ä¸–ç•Œåªæœ‰ä¸€ä¸ªåœ°æ–¹èƒ½æ‘§æ¯å®ƒï¼Ÿ"]
            },
            atmosphere: {
                imagery: ["åˆåæ…µæ‡’çš„çˆµå£«ä¹", "æš´é›¨å¤œæ‘‡æ›³çš„è·¯ç¯", "åº†å…¸ä¸Šç©ºç»šçƒ‚çš„çƒŸèŠ±", "åºŸå¼ƒæ¸¸ä¹å›­çš„é”ˆè¿¹", "æ¸…æ™¨æ—é—´çš„è–„é›¾", "æ·±å¤œä¾¿åˆ©åº—çš„ç¯å…‰", "æ‹¥æŒ¤ä½†æ²‰é»˜çš„åœ°é“è½¦å¢"],
                emotion: ["æ¸©æš–æ€€æ—§", "ç´§å¼ æ‚¬ç–‘", "æ¬¢ä¹å¸Œæœ›", "å­¤ç‹¬ä¼¤æ„Ÿ", "å®é™ç¥¥å’Œ", "å‹æŠ‘æœªçŸ¥", "è½»æ¾æ²»æ„ˆ"]
            },
            twistContent: {
                keywords: ["èº«ä»½äº’æ¢", "è®°å¿†ç¯¡æ”¹", "è™šæ‹Ÿä¸–ç•Œ", "èƒŒå›", "å®¿å‘½", "å…±ç”Ÿ", "å†’åé¡¶æ›¿", "æ— äººç”Ÿè¿˜", "åŒé‡é—´è°"],
                conflict: ["æ©äººå³æ˜¯ä»‡äºº", "æ‹¯æ•‘å³æ˜¯æ¯ç­", "è¿½æ±‚çš„åœ£ç‰©æ˜¯é‚ªç‰©", "å¯ä¿¡çš„ä¼™ä¼´æ˜¯å¹»è§‰", "æ‰“ç ´çš„è¯…å’’æ˜¯åº‡æŠ¤", "å¯¹æŠ—çš„æ•Œäººæ˜¯è‡ªå·±"],
                whatIf: ["å¦‚æœä¸»è§’æ‰æ˜¯åæ´¾ï¼Ÿ", "å¦‚æœæ•´ä¸ªæ•…äº‹éƒ½æ˜¯ä¸€åœºæ¢¦æˆ–å®éªŒï¼Ÿ", "å¦‚æœâ€œæ­»è€…â€å¹¶æ²¡æœ‰çœŸçš„æ­»å»ï¼Ÿ", "å¦‚æœç›®æ ‡è¾¾æˆåä¼šå¸¦æ¥æ›´å¤§ç¾éš¾ï¼Ÿ"]
            }
        };

        const updateProgress=()=>document.getElementById('progressFill').style.width=(currentStep/5)*100+'%';
        function updateSidebar(){const t=document.getElementById("floatingContent"),e=document.getElementById("toggleBtn");t.innerHTML="";const n=[{k:"theme",v:"ä¸»é¢˜"},{k:"anchor",v:"æ ¸å¿ƒé”šç‚¹"},{k:"anchorReason",v:"é€‰æ‹©ç†ç”±"},{k:"unexpectedAttr",v:"æ„å¤–å±æ€§"},{k:"relationship",v:"äººç‰©å…³ç³»"},{k:"atmosphere",v:"å‰æœŸæ°›å›´"},{k:"expectation",v:"è§‚ä¼—é¢„æœŸ"},{k:"twistPoint",v:"åè½¬ç‚¹"},{k:"twistContent",v:"åè½¬å†…å®¹"},{k:"emotionArc",v:"æƒ…ç»ªå¼§çº¿"}];let o=!1;n.forEach(e=>{if(data[e.k]){o=!0;const n=document.createElement("div");n.className="step-summary",n.innerHTML=`<div class="step-title">${e.v}</div><div class="step-content">${truncateText(data[e.k],45)}</div>`,t.appendChild(n)}}),e.classList.toggle("hidden",!o)}
        const toggleSummary=()=>document.getElementById("floatingSummary").classList.toggle("visible");
        const truncateText=(t,e)=>t?t.length>e?t.substring(0,e)+"...":t:"";
        function showStep(t){const e=document.querySelector(".step.active");e&&"step"+t!==e.id?(e.classList.add("animate-out"),setTimeout(()=>{e.classList.remove("active","animate-out");const o=document.getElementById("step"+t);o.classList.add("active","animate-in"),setTimeout(()=>o.classList.remove("animate-in"),500)},300)):(document.querySelectorAll(".step").forEach(t=>t.classList.remove("active")),document.getElementById("step"+t).classList.add("active")),updateProgress(),updateSidebar()}
        function startTimer(t,e){timers[t]&&clearInterval(timers[t]);let o=60*e;const n=document.getElementById("timer"+t);n.classList.remove("warning"),timers[t]=setInterval(()=>{if(o<0)return clearInterval(timers[t]),void(n.textContent="æ—¶é—´åˆ°!");const e=Math.floor(o/60),s=o%60;n.textContent=`${e}:${s.toString().padStart(2,"0")}`,o<=30&&n.classList.add("warning"),o--},1e3)}
        const stopAllTimers=()=>{Object.values(timers).forEach(t=>clearInterval(t)),timers={}};
        function collectDataForStep(t){const e="step"+t;document.querySelectorAll("#"+e+" input, #"+e+" textarea").forEach(t=>{t.id&&(data[t.id]=t.value.trim())})}
        function nextStep(){collectDataForStep(currentStep);if(0===currentStep&&!data.theme)return void alert("è¯·è¾“å…¥åˆ›ä½œä¸»é¢˜");if(1===currentStep&&!data.anchor)return void alert("è¯·è¾“å…¥æ ¸å¿ƒé”šç‚¹");currentStep<5&&(currentStep++,showStep(currentStep)),1===currentStep?startTimer(1,3):2===currentStep?startTimer(2,5):3===currentStep?startTimer(3,5):4===currentStep&&startTimer(4,7)}
        function prevStep(){currentStep>0&&(collectDataForStep(currentStep),currentStep--,showStep(currentStep))}
        function generateResult(){collectDataForStep(4),stopAllTimers(),currentStep=5,showStep(5);const t=t=>t?t.replace(/\n/g,"<br>"):"<em>æœªå¡«å†™</em>";document.getElementById("finalResult").innerHTML=[{l:"ä¸»é¢˜",c:data.theme},{l:"æ ¸å¿ƒé”šç‚¹",c:data.anchor},{l:"é€‰æ‹©ç†ç”±",c:data.anchorReason},{l:"æ„å¤–å±æ€§",c:data.unexpectedAttr},{l:"äººç‰©å…³ç³»",c:data.relationship},{l:"å‰æœŸæ°›å›´",c:data.atmosphere},{l:"è§‚ä¼—é¢„æœŸ",c:data.expectation},{l:"åè½¬è®¾è®¡",c:`<b>åè½¬ç‚¹ï¼š</b><br>${t(data.twistPoint)}<br><br><b>åè½¬å†…å®¹ï¼š</b><br>${t(data.twistContent)}`},{l:"æƒ…ç»ªå¼§çº¿",c:data.emotionArc}].map(e=>`<div class="result-item"><div class="result-label">${e.l}</div><div class="result-content">${t(e.c)}</div></div>`).join("")}
        function fillSuggestion(t,e,o=!1){const n=document.getElementById(t);o?n.value+=e:n.value=e,n.focus()}
        
        // --- V2ï¼šçµæ„ŸçŸ©é˜µåŠŸèƒ½ ---
        function showRandomSuggestions(fieldId, category) {
            const suggestions = inspirationLibrary[fieldId]?.[category];
            const container = document.getElementById(`suggestions-for-${fieldId}`);
            if (!suggestions || !container) return;

            container.style.display = 'block'; // æ˜¾ç¤ºå®¹å™¨
            const shuffled = [...suggestions].sort(() => 0.5 - Math.random());
            const count = category === 'keywords' ? 4 : 2;
            const selected = shuffled.slice(0, count);

            let contentHTML = '';
            selected.forEach(text => {
                const isKeyword = category === 'keywords';
                // å…³é”®è¯ç‚¹å‡»æ˜¯è¿½åŠ ï¼Œå…¶ä»–æ˜¯è¦†ç›–
                contentHTML += `<div class="suggestion-item-random" onclick="fillSuggestion('${fieldId}', '${text.replace(/'/g, "\\'")}', ${isKeyword})">${text}</div>`;
            });

            contentHTML += `<div class="inspiration-refresh"><button class="btn-refresh" onclick="showRandomSuggestions('${fieldId}', '${category}')">â†» æ¢ä¸€æ‰¹</button></div>`;
            container.innerHTML = contentHTML;
        }

        function exportResult(){const t=[{label:"ä¸»é¢˜",content:data.theme},{label:"æ ¸å¿ƒé”šç‚¹",content:data.anchor},{label:"é€‰æ‹©ç†ç”±",content:data.anchorReason},{label:"æ„å¤–å±æ€§",content:data.unexpectedAttr},{label:"äººç‰©å…³ç³»",content:data.relationship},{label:"å‰æœŸæ°›å›´",content:data.atmosphere},{label:"è§‚ä¼—é¢„æœŸ",content:data.expectation},{label:"åè½¬ç‚¹",content:data.twistPoint},{label:"åè½¬å†…å®¹",content:data.twistContent},{label:"æƒ…ç»ªå¼§çº¿",content:data.emotionArc}].map(t=>`${t.label}:\n${t.content||"æœªå¡«å†™"}\n`).join("\n--------------------\n\n"),e=new Blob([t],{type:"text/plain;charset=utf-8"}),o=document.createElement("a");o.href=URL.createObjectURL(e),o.download=`åˆ›æ„æ„æ€_${data.theme||"æœªå‘½å"}.txt`,o.click(),URL.revokeObjectURL(o.href)}
        function restart(){currentStep=0,data={},stopAllTimers(),document.querySelectorAll("input, textarea").forEach(t=>t.value=""),document.getElementById("floatingSummary").classList.remove("visible"),showStep(0)}
        document.addEventListener("DOMContentLoaded",()=>showStep(0));
    </script>
</body>
</html>
